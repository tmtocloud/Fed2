<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE MudletPackage>
<MudletPackage version="1.001">
	<TriggerPackage>
		<TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
			<name>fed2ui</name>
			<script></script>
			<triggerType>0</triggerType>
			<conditonLineDelta>0</conditonLineDelta>
			<mStayOpen>0</mStayOpen>
			<mCommand></mCommand>
			<packageName>fed2ui</packageName>
			<mFgColor>#ff0000</mFgColor>
			<mBgColor>#ffff00</mBgColor>
			<mSoundFile></mSoundFile>
			<colorTriggerFgColor>#000000</colorTriggerFgColor>
			<colorTriggerBgColor>#000000</colorTriggerBgColor>
			<regexCodeList />
			<regexCodePropertyList />
			<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
				<name>spynet notice catch</name>
				<script></script>
				<triggerType>0</triggerType>
				<conditonLineDelta>0</conditonLineDelta>
				<mStayOpen>0</mStayOpen>
				<mCommand></mCommand>
				<packageName></packageName>
				<mFgColor>#ff0000</mFgColor>
				<mBgColor>#ffff00</mBgColor>
				<mSoundFile></mSoundFile>
				<colorTriggerFgColor>#000000</colorTriggerFgColor>
				<colorTriggerBgColor>#000000</colorTriggerBgColor>
				<regexCodeList>
					<string>SPYNET REPORT:</string>
				</regexCodeList>
				<regexCodePropertyList>
					<integer>2</integer>
				</regexCodePropertyList>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>login logout redirect</name>
					<script>--does some basic formatting and redirects the login/logout notice to the overflow window.
--does not catch players with [ ] titles
--matches[2] is the player rank, matches[3] is the player name, matches[4] is login / logout
FEDUI.overflowWindow:cecho("SPYNET REPORT: &lt;b&gt;"..matches[2].." "..matches[3].."&lt;/b&gt; has &lt;b&gt;".. matches[4].."&lt;/b&gt; Federation DataSpace.\n")
tempLineTrigger(0, 2, [[deleteLine()]]) --delete the current line and the next line, to catch the newline after every SPYNET REPORT</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>0</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>SPYNET REPORT: (\w+) (\w+) has (entered|left) Federation DataSpace</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>1</integer>
					</regexCodePropertyList>
				</Trigger>
			</Trigger>
			<TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
				<name>ExchangeTriggers</name>
				<script></script>
				<triggerType>0</triggerType>
				<conditonLineDelta>0</conditonLineDelta>
				<mStayOpen>0</mStayOpen>
				<mCommand></mCommand>
				<packageName></packageName>
				<mFgColor>#ff0000</mFgColor>
				<mBgColor>#ffff00</mBgColor>
				<mSoundFile></mSoundFile>
				<colorTriggerFgColor>#000000</colorTriggerFgColor>
				<colorTriggerBgColor>#000000</colorTriggerBgColor>
				<regexCodeList>
					<string>+++</string>
				</regexCodeList>
				<regexCodePropertyList>
					<integer>2</integer>
				</regexCodePropertyList>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>echoRemoteExchange_Commodity</name>
					<script>--puts the Commodity name into the exchange window
local basePrice = FEDUI.commoditiesBasePrice[matches[2]] or "???"
FEDUI.overflowWindow:echo("+++\n")
FEDUI.overflowWindow:cecho('&lt;ansiYellow&gt;' .. matches[2] .. ' (base ' .. basePrice ..'):\n')
deleteLine()
tempLineTrigger(1,1, [[if getCurrentLine() == "" then deleteLine() end]]) --if the following line is blank, delete it</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>1</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>^\+{3} The display shows the prices for (.+) \+{3}$</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>1</integer>
					</regexCodePropertyList>
				</Trigger>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>echoLocalExchange_Commodity</name>
					<script>--puts the Commodity name into the exchange window
local basePrice = FEDUI.commoditiesBasePrice[matches[2]] or "???"
FEDUI.overflowWindow:echo("+++\n")
FEDUI.overflowWindow:cecho('&lt;ansiYellow&gt;' .. matches[2] .. ' (base ' .. basePrice ..'):\n')
deleteLine()
tempLineTrigger(1,1, [[if getCurrentLine() == "" then deleteLine() end]]) --if the following line is blank, delete it</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>1</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>^\+{3} The exchange display shows the prices for (.+) \+{3}$</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>1</integer>
					</regexCodePropertyList>
				</Trigger>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>echoExchange_Buy</name>
					<script>--puts the buying price (matches[3]) into exchange window
--matches[4] contains the 'ig/ton' that usually follows a buying price
--matches[2] is the amount they're willing to purchase, but this should always be 75 tons?
--maybe do some multiplication to get actual price for a 75 ton container?
FEDUI.overflowWindow:cecho('&lt;ansiYellow&gt;Buying at: ' .. matches[3] ..'\n')
deleteLine()
tempLineTrigger(1,1, [[if getCurrentLine() == "" then deleteLine() end]]) --if the following line is blank, delete it</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>1</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>^\+{3} Exchange will buy (\d+) tons at (\d+)(.+) \+{3}</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>1</integer>
					</regexCodePropertyList>
				</Trigger>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>echoExchange_Sell</name>
					<script>--puts the selling price (matches[2]) into exchange window
--matches[3] is the ig/ton that usually follows the price
--matches[4] is the amount they're willing to sell, but this should always be 75 tons?
FEDUI.overflowWindow:cecho('&lt;ansiYellow&gt;Selling at: ' .. matches[2] ..'\n')
deleteLine()
tempLineTrigger(1,1, [[if getCurrentLine() == "" then deleteLine() end]]) --if the following line is blank, delete it</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>1</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>^\+{3} Offer price is (\d+)(.+) for first (\d+) tons \+{3}$</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>1</integer>
					</regexCodePropertyList>
				</Trigger>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>echoExchange_Quant</name>
					<script>--puts the amount available into exchange window
FEDUI.overflowWindow:cecho('&lt;ansiYellow&gt;Available: ' .. matches[2] ..'\n')
deleteLine()
tempLineTrigger(1,1, [[if getCurrentLine() == "" then deleteLine() end]]) --if the following line is blank, delete it</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>1</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>^\+{3} Exchange has (.+) for sale \+{3}$</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>1</integer>
					</regexCodePropertyList>
				</Trigger>
			</TriggerGroup>
			<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
				<name>CommanderWork</name>
				<script>clearWindow("FEDUI.cargoWindow") --reset the window, no need to have old cargo sticking around
FEDUI.cargoWindow:cecho("&lt;b&gt;Available Work:&lt;/b&gt;\n")
--FEDUI.cargoWindow:cecho("Job#. Planets - Allowed/Actual Travel Time (Pay)\n")</script>
				<triggerType>0</triggerType>
				<conditonLineDelta>0</conditonLineDelta>
				<mStayOpen>99</mStayOpen>
				<mCommand></mCommand>
				<packageName></packageName>
				<mFgColor>#ff0000</mFgColor>
				<mBgColor>#ffff00</mBgColor>
				<mSoundFile></mSoundFile>
				<colorTriggerFgColor>#000000</colorTriggerFgColor>
				<colorTriggerBgColor>#000000</colorTriggerBgColor>
				<regexCodeList>
					<string>Work available from Armstrong Cuthbert:</string>
				</regexCodeList>
				<regexCodePropertyList>
					<integer>3</integer>
				</regexCodePropertyList>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>CatchJob</name>
					<script>local function rpad(str, len)
  str = tostring(str)
  local pad = len - #str
  if pad &gt; 0 then
    return str .. string.rep(" ", pad)
  end
  return str:sub(1, len)
end

--this assumes jobs are provided in lots of 75 tons
--does not capture or display hauling credits per job
-- Job IDs can be clicked on to send the ac JobNum command to FED
-- Planets can be clicked on to send whereis planetName to FED

local jobNum   = matches[2]       --what is the job number
local startLoc = matches[3]     --what planet is the collection point
local destLoc  = matches[4]      --what planet is the delivery point
FEDUI.jobTime  = matches[5]      --how long do you have to deliver it
FEDUI.jobPay   = matches[6] * 75  --how much per ton you're paid * 75 tons of cargo

FEDUI.combineLoc = {startLoc, destLoc}  --put the two planets in one location
table.sort(FEDUI.combineLoc)                        --alphabetize them
FEDUI.combineLoc = table.concat(FEDUI.combineLoc)   --smush the alphabetized planets together

-- If out of Sol, dont try to calculate gtu
if gmcp.room.info.system == "Sol" then
  FEDUI.calcTime = FEDUI.solDistances[FEDUI.combineLoc] --use that to get the actual time between startLoc and destLoc

  if tonumber(FEDUI.calcTime) &gt; tonumber(FEDUI.jobTime) then      --you don't have enough time to deliver without penalties
    --we're just not gonna do anything here
  elseif tonumber(FEDUI.calcTime) &lt; tonumber(FEDUI.jobTime) then  --you can deliver faster than allocated time and may receive bonuses
    FEDUI.haulingWindow:cechoLink("&lt;blue&gt;&lt;u&gt;" .. jobNum .. "&lt;/u&gt;&lt;reset&gt;",function() send("ac " .. jobNum) end, "Accept job " .. jobNum, true)
    FEDUI.haulingWindow:cecho(" &lt;ansiCyan&gt;"..rpad(startLoc,8).."&lt;reset&gt; &gt; &lt;ansiCyan&gt;"..rpad(destLoc,8)..
    "&lt;reset&gt; &lt;b&gt;"..FEDUI.jobTime.."/&lt;ansiGreen&gt;"..FEDUI.calcTime.."&lt;reset&gt;gtu - &lt;b&gt;"
    ..FEDUI.jobPay.."&lt;/b&gt;ig (&lt;b&gt;&lt;ansiGreen&gt;".. math.floor(FEDUI.jobPay+(FEDUI.jobPay*.2)) .."&lt;reset&gt;&lt;/b&gt;ig)\n")
  else --
    FEDUI.haulingWindow:cecho(jobNum.." &lt;ansiCyan&gt;"..rpad(startLoc,8).."&lt;reset&gt; &gt; &lt;ansiCyan&gt;"..rpad(destLoc,8)..
    "&lt;reset&gt; &lt;b&gt;"..FEDUI.jobTime.."/"..FEDUI.calcTime.."&lt;/b&gt;gtu - &lt;b&gt;"..FEDUI.jobPay.."&lt;/b&gt;ig\n")
  end
else
  FEDUI.haulingWindow:cechoLink("&lt;blue&gt;&lt;u&gt;" .. jobNum .. "&lt;/u&gt;&lt;reset&gt;",function() send("ac " .. jobNum) end, "Accept job " .. jobNum, true)
  FEDUI.haulingWindow:cechoLink(" &lt;ansiCyan&gt;" .. rpad(startLoc,13).."&lt;reset&gt;",function() send("whereis " .. startLoc) end, "Find " .. startLoc, true)
  FEDUI.haulingWindow:cecho(" &gt; ")
  FEDUI.haulingWindow:cechoLink("&lt;ansiCyan&gt;" .. rpad(destLoc,13) .. "&lt;reset&gt;",function() send("whereis " .. destLoc) end, "Find " .. destLoc, true)
  FEDUI.haulingWindow:cecho(" &lt;b&gt;" .. FEDUI.jobTime .. "&lt;/b&gt;gtu - &lt;b&gt;" .. FEDUI.jobPay .. "&lt;/b&gt;ig\n")
end
deleteLine()</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>0</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>(\d+)\.\s+(?:From|From The)\s+(.+?)\s+(?:to|to The)\s+(.+?)\s+-\s+.+?\s+-\s+(\d+)gtu\s+(\d+)ig</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>1</integer>
					</regexCodePropertyList>
				</Trigger>
				<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
					<name>CatchBlank</name>
					<script>setTriggerStayOpen("Commander Work", 0)</script>
					<triggerType>0</triggerType>
					<conditonLineDelta>0</conditonLineDelta>
					<mStayOpen>0</mStayOpen>
					<mCommand></mCommand>
					<packageName></packageName>
					<mFgColor>#ff0000</mFgColor>
					<mBgColor>#ffff00</mBgColor>
					<mSoundFile></mSoundFile>
					<colorTriggerFgColor>#000000</colorTriggerFgColor>
					<colorTriggerBgColor>#000000</colorTriggerBgColor>
					<regexCodeList>
						<string>^\|\s*$</string>
					</regexCodeList>
					<regexCodePropertyList>
						<integer>1</integer>
					</regexCodePropertyList>
				</Trigger>
			</Trigger>
			<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
				<name>cPriceCartelGetData</name>
				<script>local system = matches[2]
local planet = matches[3]
local action = matches[4]
local quantity = matches[5]
local price = matches[6]

-- Store the data
table.insert(FEDUI.trading.data, {
  system = system,
  planet = planet,
  action = action,
  quantity = tonumber(quantity),
  price = tonumber(price)
})

FEDUI.trading.lastLineWasPrice = true  -- Flag for blank line trigger
deleteLine()</script>
				<triggerType>0</triggerType>
				<conditonLineDelta>0</conditonLineDelta>
				<mStayOpen>0</mStayOpen>
				<mCommand></mCommand>
				<packageName></packageName>
				<mFgColor>#ff0000</mFgColor>
				<mBgColor>#ffff00</mBgColor>
				<mSoundFile></mSoundFile>
				<colorTriggerFgColor>#000000</colorTriggerFgColor>
				<colorTriggerBgColor>#000000</colorTriggerBgColor>
				<regexCodeList>
					<string>^([\w\s]+): ([\w\s]+) is (buying|selling) (\d+) tons at (\d+)ig/ton$</string>
				</regexCodeList>
				<regexCodePropertyList>
					<integer>1</integer>
				</regexCodePropertyList>
			</Trigger>
			<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
				<name>cPriceCartelPrint</name>
				<script>FEDUI.trading = FEDUI.trading or {}

if not FEDUI.trading.lastLineWasPrice or #FEDUI.trading.data == 0 then 
  FEDUI.trading.lastLineWasPrice = false
  return 
end

FEDUI.trading.lastLineWasPrice = false

-- If we're in profit search mode, process differently
if FEDUI.trading.profitSearch and FEDUI.trading.profitSearch.active then
  FEDUI.processProfitSearchResults()
  FEDUI.trading.data = {}
  deleteLine()
  return
end

local function rpad(str, len)
  str = tostring(str)
  local pad = len - #str
  if pad &gt; 0 then
    return str .. string.rep(" ", pad)
  end
  return str:sub(1, len)
end

-- 1. PRE-CALCULATE BEST PRICES
local bestBuyPrice  = math.huge
local bestSellPrice = -1

for _, item in ipairs(FEDUI.trading.data) do
  if item.action == "selling" then -- Station sells, we BUY
    if item.price &lt; bestBuyPrice then bestBuyPrice = item.price end
  elseif item.action == "buying" then -- Station buys, we SELL
    if item.price &gt; bestSellPrice then bestSellPrice = item.price end
  end
end

-- Sort by price
table.sort(FEDUI.trading.data, function(a, b)
  return a.price &lt; b.price
end)

-- Display header
FEDUI.tradingWindow:cecho("&lt;white&gt;System    Planet        Action  Qty   Price\n")
FEDUI.tradingWindow:cecho("&lt;white&gt;──────────────────────────────────────────\n")

-- Display each entry
for _, item in ipairs(FEDUI.trading.data) do
  -- Column A: Combined action + command
  local actionBtn

  if item.action == "buying" then
    actionBtn = "&lt;green&gt;[SELL]&lt;reset&gt;"
  else
    actionBtn = "&lt;yellow&gt;[BUY]&lt;reset&gt; "
  end
  
  FEDUI.tradingWindow:cechoLink(rpad(item.system, 9),function() send("j " .. item.system) end,"Jump to: " .. item.system,true)
  FEDUI.tradingWindow:cecho(" ")
  
  -- Clickable planet name (truncated to 13 chars)
  local planetDisplay = rpad(item.planet:sub(1, 13), 13)

  FEDUI.tradingWindow:cechoLink(
    "&lt;ansiCyan&gt;" .. planetDisplay .. "&lt;reset&gt;",
    function() send("whereis " .. item.planet) end,
    item.planet,  -- Full name in tooltip
    true
  )
  
  FEDUI.tradingWindow:cecho(" ")
  
  -- Clickable action button
  local cmd = (item.action == "buying") and "sell " or "buy "
  FEDUI.tradingWindow:cechoLink(
    actionBtn,
    function() send(cmd .. FEDUI.trading.currentCommodity) end,
    cmd .. FEDUI.trading.currentCommodity,
    true
  )
  
  FEDUI.tradingWindow:cecho(" " .. rpad(item.quantity, 5) .. " ")
  -- Highlight the price in green if it's the best price point
  local priceStr = rpad(item.price .. "ig", 6)

  if (item.action == "selling" and item.price == bestBuyPrice) or 
     (item.action == "buying" and item.price == bestSellPrice) then
    FEDUI.tradingWindow:cecho("&lt;green&gt;" .. priceStr .. "&lt;reset&gt;\n")
  else
    FEDUI.tradingWindow:cecho("&lt;white&gt;" .. priceStr .. "&lt;reset&gt;\n")
  end
end

-- 3. FOOTER WITH PROFIT CALCULATION
local profitMsg = ""
if bestBuyPrice ~= math.huge and bestSellPrice ~= -1 then
  local delta = bestSellPrice - bestBuyPrice
  if delta &gt; 0 then
    profitMsg = string.format(" | &lt;green&gt;Best Profit: %dig/ton&lt;reset&gt;", delta)
  else
    profitMsg = " | &lt;red&gt;No Profit Delta&lt;reset&gt;"
  end
end

FEDUI.tradingWindow:cecho("\n&lt;white&gt;" .. #FEDUI.trading.data .. " exchanges" .. profitMsg .. "\n")</script>
				<triggerType>0</triggerType>
				<conditonLineDelta>0</conditonLineDelta>
				<mStayOpen>0</mStayOpen>
				<mCommand></mCommand>
				<packageName></packageName>
				<mFgColor>#ff0000</mFgColor>
				<mBgColor>#ffff00</mBgColor>
				<mSoundFile></mSoundFile>
				<colorTriggerFgColor>#000000</colorTriggerFgColor>
				<colorTriggerBgColor>#000000</colorTriggerBgColor>
				<regexCodeList>
					<string>^$</string>
				</regexCodeList>
				<regexCodePropertyList>
					<integer>1</integer>
				</regexCodePropertyList>
			</Trigger>
			<Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
				<name>findBestProfitHide</name>
				<script>-- If we're in profit search mode, hide command spam
if FEDUI.trading.profitSearch and FEDUI.trading.profitSearch.active then
  deleteLine()

  return
end</script>
				<triggerType>0</triggerType>
				<conditonLineDelta>0</conditonLineDelta>
				<mStayOpen>0</mStayOpen>
				<mCommand></mCommand>
				<packageName></packageName>
				<mFgColor>#ff0000</mFgColor>
				<mBgColor>#ffff00</mBgColor>
				<mSoundFile></mSoundFile>
				<colorTriggerFgColor>#000000</colorTriggerFgColor>
				<colorTriggerBgColor>#000000</colorTriggerBgColor>
				<regexCodeList>
					<string>^Your comm unit lights up as your brokers, Messrs Trum.*</string>
					<string>^requested spot market p.*</string>
					<string>.*is not currently trading in this commodity$</string>
				</regexCodeList>
				<regexCodePropertyList>
					<integer>1</integer>
					<integer>1</integer>
					<integer>1</integer>
				</regexCodePropertyList>
			</Trigger>
		</TriggerGroup>
	</TriggerPackage>
</MudletPackage>
